(function() {
  var self = this;
  var reporter = window.ZendeskReporter ? new window.ZendeskReporter() : {};
  function wrapped$() {
    console.log('AppScope Violated!');
    console.log('Sending hostname:' + self.location.hostname + ' to DD');
    reporter.increment && reporter.increment(
      'app_framework.app_scope.violated',
      1,
      ['origin:' + self.location.hostname]
    );
    return self.$.apply(null, arguments);
  }

  var wrappedWindow = this.$.extend(true, {}, self, { $: wrapped$ });
  wrappedWindow.window = wrappedWindow;
  wrappedWindow.top = wrappedWindow;

  <% appsjs.each do |appjs| %>
    <%= appjs %>
  <% end %>

  <% installations.each do |installation| %>
    if (ZendeskApps[<%= installation.app_name.to_json %>]) {
      ZendeskApps[<%= installation.app_name.to_json %>].install(<%= installation.to_json %>);
    }
  <% end %>

  <% installation_orders.each do |loc_name, installation_list| %>
    ZendeskApps.sortAppsForSite(<%= loc_name.to_json %>, <%= installation_list.to_json %>);
  <% end %>
}());

<% unless rollbar_zaf_access_token.empty? %>
ZendeskApps.rollbarAccessToken = "<%= rollbar_zaf_access_token %>";
<% end %>

ZendeskApps.trigger && ZendeskApps.trigger('ready');
